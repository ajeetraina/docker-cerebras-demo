services:
  critic-agent-a2a:
    build:
      target: critic-agent
    ports:
      - "8001:8001"
    environment:
      - MCPGATEWAY_ENDPOINT=http://mcp-gateway:8811/sse
    depends_on:
      # compose docker-model-runner provider injects environment variables
      - docker_model_runner
      - mcp-gateway

  auditor-agent-a2a:
    build:
      target: auditor-agent
    ports:
      - "8002:8002"
    environment:
      - CRITIC_AGENT_URL=http://critic-agent-a2a:8001
    depends_on:
      # compose docker-model-runner provider injects environment variables
      - docker_model_runner
      - mcp-gateway

  docker_model_runner:
    provider:
      type: model
      options:
        # pre-pull the model on Docker Model Runner
        #model: olegselajev241/qwen3:14B-Q6_K
        model: ai/gemma3-qat:27B-Q4_K_M	
        context-size: 20000

  mcp-gateway:
    image: docker/mcp-gateway:latest
    ports:
      - "8811:8811"
    command:
      - --transport=sse
      - --servers=duckduckgo
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
